This repository imports and analyzes data from both the [TNG simulation](https://www.tng-project.org/data/) and the [BAHAMAS simulation](https://arxiv.org/abs/1603.02702). The ROCKSTAR ([Robust Overdensity Calculation using K-Space Topologically Adaptive Refinement](https://iopscience.iop.org/article/10.1088/0004-637X/762/2/109)) halo finder is used on the TNG simulation particles to resolve cluster substructure from the full 6D phase space. The output of ROCKSTAR for each simulation looks like this: 

<p align="center">
  <img src="TNG_cluster_dynamics/figures/rockstar_bubbles.png" alt="rockstar_substrcuture" width="width:100%" />
</p>

The goal of this project is to develop methods that are able to identify cluster substructure from observed cluster-member galaxies observed dynamical quantities ($x$, $y$, $v_z$). The methods that are being developed/studied are:

1. The [DS+](https://github.com/josegit88/MilaDS) algorithm to find substucture using two dimensional postions and line of sight velocity. We have also added a virial mass calculation of each substructure that is identified as well as the entire virial mass of the galaxy cluster. All funcitons used in this analysis are stored in the TNG_DA.py script with the script that actually runs this code in the DS+ folder. 

2. A Convolutional Graph Neural Network (ConvGNN) is trained on the dynamics of cluster-member galaxy dynamics from the BAHAMAS simulation simulations that include multiple dark matter simulations. The model is trained on observable quantities ($x$, $y$, $v_z$) as inputs and outputs unobserved quantities ($z$, $v_x$, $v_y$). We then test the effectiveness of the ConvGNN on the TNG300 data as an out-of-dsitribution dataset. We will compare multiple loss functions, which include the mean-squared-loss error and the maximization of the Shanon Entropy of the galaxy clsuter derived using classical statistical mechanics. The full 6D phase space is then used to find the cluster substructure using a clustering algorithm called [astrolink](https://github.com/william-h-oliver/astrolink). Code for this analysis is stored in the GNN folder.

The methods from this study that prove to be the most effective at distinguishing dark matter models from cluster substucture will be applied to observations from the Local Volume Complete Cluster Survey ([LoVoCCS](10.3847/1538-4357/ad67c6)) in a follow-up study. 